<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пользовательская панель</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .answer { margin: 10px 0; }
    </style>
</head>
<body>
<h1>Пользовательская панель</h1>
<div>
    <label for="username">Введите ваше имя:</label>
    <input type="text" id="username" />
    <button onclick="startSurvey()">Начать опрос</button>
</div>
<div class="question-container" style="display:none;">
    <h2 id="question"></h2>
    <div class="answers" id="answersContainer"></div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
   
        let answersArray;
        let UserAnswersArray = [];
        let QuestionIndex = 0;
        let currentQuestionText = '';
        
        const socket = io();
        // answersArray = ['101', '2', '3', '4'];
        console.log("start");
        let answers = [' 1', 'Ответ 2', 'Ответ 3', 'Ответ 4'];
        function startSurvey() {
            const username = document.getElementById('username').value;
            if (username) {
                localStorage.setItem('username', username);
                displayQuestion();
                document.querySelector('.question-container').style.display = 'block';
            } else {
                alert('Пожалуйста, введите ваше имя.');
            }
        }
        //work
        function displayQuestion() {
            const questionText = localStorage.getItem('currentQuestion');
            console.log('currentQuestionText',currentQuestionText)
            if (currentQuestionText !== undefined) {
                document.getElementById('question').innerText = currentQuestionText;
                updateAnswers();
            } else {
                document.getElementById('question').innerText = "Ожидание вопроса от администратора...";
            }
        }
        //work
        function updateAnswers() {
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = ''; // Очистить предыдущие ответы
            answersArray.forEach(answer => {
                const btn = document.createElement('button');
                btn.innerText = answer;
                btn.classList.add('answer');
                btn.onclick = () => submitAnswer(answer);
                answersContainer.appendChild(btn);
            });

        }

        function submitAnswer(answer) {
            // if (UserAnserIndex > -1){UserAnswersArray[UserAnserIndex] = answer}
            console.log('UserAnswersArray',UserAnswersArray);
            console.log('answer',answer);

            alert('Ваш ответ отправлен: ' + answer);
            // updateAnswers(localStorage.getItem('currentQuestion'));  // Обновить для следующего вопроса
            const UserAnswerPackage = [username.value,QuestionIndex,answer];
            socket.emit('UserAnswerPackage',UserAnswerPackage);
        }


        //work // Get quuestion from Server
        socket.on('question', (question) => {
            console.log('question',question);
            currentQuestionText = question[0]
            answersArray = question[1];
            QuestionIndex = question[2];
            displayQuestion(); // Обновляем отображение вопроса
        });

    </script>
</body>
</html>
